var $container,pageInitialized=!1,activeUploads=0,currentUpload=0;$(document).ready(function(){pageInitialized||(pageInitialized=!0,$(".justified-gallery").justifiedGallery({sizeRangeSuffixes:{lt100:"",lt240:"",lt320:"",lt500:"",lt640:"",lt1024:""}}))});
var curImages=new Array,activityIndicatorOn=function(){$('<div id="imagelightbox-loading"><div class="csspinner traditional"></div></div>').appendTo("body")},activityIndicatorOff=function(){$("#imagelightbox-loading").remove()},overlayOn=function(){$("#imagelightbox-overlay").remove(),$('<div id="imagelightbox-overlay"></div>').appendTo("body")},overlayOff=function(){$("#imagelightbox-overlay").remove()},captionOn=function(){var i=$('a[href="'+$("#imagelightbox").attr("src")+'"] img').attr("title");i&&i.length>0&&$('<div id="imagelightbox-caption">'+i+"</div>").appendTo("body")},captionOff=function(){$("#imagelightbox-caption").remove()};$(document).ready(function(){$("a.lightbox").imageLightbox({onLoadStart:function(){overlayOn(),captionOff(),activityIndicatorOn()},onLoadEnd:function(){captionOn(),activityIndicatorOff()},onEnd:function(){overlayOff(),captionOff()}})});
$(document).ready(function(){$("#post-form textarea").liveUrl({loadStart:function(){$(".liveurl-loader").show()},loadEnd:function(){$(".liveurl-loader").hide()},success:function(e){var i=$(".liveurl");if(i.find(".title").text(e.title),i.find(".description").text(e.description),i.find(".url").text(e.url),i.find(".image").empty(),i.find(".close").one("click",function(){var e=$(this).parent();e.hide("fast"),e.find(".video").html("").hide(),e.find(".image").html(""),e.find(".controls .prev").addClass("inactive"),e.find(".controls .next").addClass("inactive"),e.find(".thumbnail").hide(),e.find(".image").hide(),$("textarea").trigger("clear"),curImages=new Array}),i.show("fast"),null!=e.video){var t=e.video.width/350;e.video.width=350,e.video.height=e.video.height/t;var a='<object width="'+e.video.width+'" height="'+e.video.height+'">'+'<param name="movie"'+'value="'+e.video.file+'"></param>'+'<param name="allowScriptAccess" value="always"></param>'+'<embed src="'+e.video.file+'"'+'type="application/x-shockwave-flash"'+'allowscriptaccess="always"'+'width="'+e.video.width+'" height="'+e.video.height+'"></embed>'+"</object>";i.find(".video").html(a).show()}},addImage:function(e){var i=$(".liveurl"),t=$(e);return t.attr("alt","Preview"),e.width/e.height>7||e.height/e.width>4?!1:(curImages.push(t.attr("src")),i.find(".image").append(t),1==curImages.length&&(i.find(".thumbnail .current").text("1"),i.find(".thumbnail").show(),i.find(".image").show(),t.addClass("active")),2==curImages.length&&i.find(".controls .next").removeClass("inactive"),i.find(".thumbnail .max").text(curImages.length),void 0)}}),$(".liveurl ").on("click",".controls .button",function(){var e=$(this),i=$(this).parents(".liveurl"),t=i.find(".image"),a=$("img",t),n=$("img.active",t);if(e.hasClass("next"))var d=n.next("img");else var d=n.prev("img");if(d.length>0&&(n.removeClass("active"),d.addClass("active"),i.find(".thumbnail .current").text(d.index()+1),(d.index()+1==a.length||1==d.index()+1)&&e.addClass("inactive")),e.hasClass("next"))var l=d.prev("img");else var l=d.next("img");l.length>0?e.hasClass("next")?e.prev().removeClass("inactive"):e.next().removeClass("inactive"):e.hasClass("next")?e.prev().addClass("inactive"):e.next().addClass("inactive")})});
$(document).ready(function(){$container=$("#post-uploads"),$container.masonry({gutter:10}),$container.imagesLoaded(function(){$container.masonry({gutter:10})}),$("#post-fileupload").fileupload({dataType:"json",change:function(e,o){activeUploads+=o.files.length,$("#progress").show()},done:function(e,o){$.each(o.result.files,function(e,o){var t=new EJS({url:"/js/templates/upload.ejs"}).render(o);t=$.parseHTML(t),$container.append($(t)),imagesLoaded(document.querySelector("#post-uploads"),function(){$container.masonry("appended",$(t))}),currentUpload++===activeUploads-1&&($("#progress").hide(),activeUploads=0)})}}),$("#post-fileupload").bind("fileuploadprogress",function(e,o){console.log(o)}),$("#profile-fileupload").fileupload({dataType:"json",change:function(){$("#profile-progress").show()},done:function(e,o){$("#profile-progress").hide(),$.each(o.result.files,function(e,o){var t=new EJS({url:"/js/templates/profile-photo.ejs"}).render(o);$("#profile-photo").html(t)})}}),$("body").on("click",".btn-remove-upload",function(e){e.preventDefault();var o=this,t=$(this).data("action");return $.ajax({url:t,type:"DELETE",success:function(e){e&&e.success&&($(o).closest(".upload").remove(),$container.masonry())}}),!1}),$("body").on("click",".btn-remove-profile-photo",function(e){e.preventDefault();var o=this,t=$(this).data("action"),n='<img src="http://www.mrisug.org/Images/default.jpg" alt="profile photo">';return n+='<input type="hidden" name="profileFile" value="" />',$.ajax({url:t,type:"DELETE",success:function(e){e&&e.success&&($(o).closest(".upload").remove(),$("#profile-photo").html())}}),!1})});